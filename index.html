<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Happy Coin - نسخه 0.2.4</title>
  <!-- Vazir Font -->
  <link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
  <!-- CryptoJS for AES Encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { background:#fffbe6; font-family:'Vazir',monospace; text-align:center; padding:20px; transition:background .5s,color .5s; }
    body.dark { background:#121212; color:#eee; }
    #loginDiv,#gameDiv{max-width:480px;margin:auto;}
    input, button { font-family:'Vazir',monospace; font-size:14px; }
    input { padding:8px; width:80%; margin:5px; border:2px solid #c29200; border-radius:4px; text-align:center; }
    button { background:#c29200; border:none; color:#fff; padding:8px 16px; margin:5px; border-radius:4px; cursor:pointer; box-shadow:2px 2px 0 #7a5700; transition:background .3s; }
    button:hover { background:#a17300; }
    #coin { width:150px; height:150px; border-radius:50%; cursor:pointer; transition:transform .15s; }
    #coin.clicked { transform:scale(1.1) rotate(10deg); }
    #count,#blackCoins,#timer { font-size:14px; margin:10px 0; color:#7a5700; text-shadow:1px 1px 0 #f0e68c; }
    .section { margin-top:20px; padding:10px; border:2px solid #c29200; border-radius:6px; background:#fff8d6; }
    .floor-btn { margin:3px; }
    #eventBtn { position:fixed; top:20px; right:20px; padding:10px 20px; font-size:14px; animation:neon 1.5s ease-in-out infinite alternate; }
    @keyframes neon { from{box-shadow:0 0 4px #fffbe6,0 0 8px #c29200;} to{box-shadow:0 0 12px #fff,0 0 24px #ff4500;} }
    #eventGame { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:#fff; }
    #eventContent { max-width:500px; margin:50px auto; padding:20px; background:#222; border-radius:8px; text-align:center; }
    .window-item { display:inline-block; width:80px; height:80px; margin:10px; background:#444; border-radius:4px; position:relative; }
    .window-item.active { box-shadow:0 0 10px #ff0; }
    .window-item p { position:absolute; top:30px; left:0; width:100%; font-size:24px; }
  </style>
</head>
<body>
  <div id="loginDiv">
    <h2>Happy Coin 🎮</h2>
    <input type="text" id="usernameInput" placeholder="اسم خود را وارد کنید..."/>
    <br><button id="loginBtn">ورود / ثبت‌نام</button>
  </div>  <div id="gameDiv" style="display:none;">
    <h2>سلام <span id="displayName"></span>!</h2>
    <img id="coin" src="https://i.postimg.cc/nrWTP5cb/coin-pixel.png" alt="سکه"/>
    <div id="count">سکه: 0</div>
    <div id="blackCoins">سیاه: 0</div><div class="section" id="shop">
  <h3>🛒 فروشگاه</h3>
  <button id="darkModeBtn">تغییر تم (رایگان)</button><br>
  <button id="autoBtn">خرید Auto-Click (۴۵ سکه سیاه)</button>
  <div id="autoStatus"></div>
</div>

<div class="section" id="dailyChallenge">
  <h3>خرید طبقات</h3>
  <div id="floorsContainer"></div>
</div>

<div class="section" id="miniGameSection">
  <h3>بازی‌های طبقه‌ها</h3>
  <div id="miniGameContainer"></div>
</div>

<div class="section" id="cheatDiv">
  <button id="cheatBtn">اعمال کد تقلب</button>
</div>

<div id="footer">نسخه:0.2.4 | Rob Lucci</div>

  </div><button id="eventBtn">ایونت</button>

  <div id="eventGame">
    <div id="eventContent">
      <h3>چالش ایونت</h3>
      <p>راهنما: ۵ پنجره. ◉ = ببند، ◯ = نور. ۶۰ ثانیه.</p>
      <div id="timer">زمان: 60</div>
      <div id="windowsContainer"></div>
      <button id="closeEventBtn">خروج</button>
    </div>
  </div><script>
  const KEY='RobLucci🔐StrongKey2025';
  const encrypt=data=>CryptoJS.AES.encrypt(JSON.stringify(data),KEY).toString();
  const decrypt=txt=>{try{return JSON.parse(CryptoJS.AES.decrypt(txt,KEY).toString(CryptoJS.enc.Utf8))}catch{return{}}};

  let users=decrypt(localStorage.getItem('users')||'');
  let cheats=decrypt(localStorage.getItem('cheats')||'');
  let current;
  let autoInterval, autoTimeout;

  function saveAll(){localStorage.setItem('users',encrypt(users));localStorage.setItem('cheats',encrypt(cheats));}

  document.getElementById('loginBtn').onclick=()=>{
    const name=document.getElementById('usernameInput').value.trim();
    if(name.length<2)return alert('اسم باید حداقل ۲ حرف باشد');
    current=name;
    if(!users[current])users[current]={coins:0,blackCoins:0,floors:0,dark:false};
    localStorage.setItem('current',encrypt(current));
    saveAll();
    document.getElementById('loginDiv').style.display='none';
    document.getElementById('gameDiv').style.display='block';
    initGame();
  };

  window.onload=()=>{
    const saved=decrypt(localStorage.getItem('current'));
    if(saved && users[saved]){
      current=saved;
      document.getElementById('loginDiv').style.display='none';
      document.getElementById('gameDiv').style.display='block';
      initGame();
    }
  };

  function initGame(){
    updateUI(); renderFloors(); renderMiniGames(); setupShop(); setupEvent();
    document.getElementById('coin').onclick=addCoin;
    document.getElementById('darkModeBtn').onclick=toggleDark;
    document.getElementById('autoBtn').onclick=buyAuto;
    document.getElementById('cheatBtn').onclick=applyCheat;
  }

  function updateUI(){
    const u=users[current];
    document.getElementById('displayName').innerText=current;
    document.getElementById('count').innerText='سکه: '+u.coins;
    document.getElementById('blackCoins').innerText='سیاه: '+u.blackCoins;
    document.body.classList.toggle('dark',u.dark);
  }

  function addCoin(){const u=users[current];u.coins++;if(u.coins%15===0)u.blackCoins++;saveAll();updateUI();const c=document.getElementById('coin');c.classList.add('clicked');setTimeout(()=>c.classList.remove('clicked'),200);}
  function toggleDark(){users[current].dark=!users[current].dark;saveAll();updateUI();}

  // Auto-Click
  function setupShop(){const u=users[current]; const status=document.getElementById('autoStatus');
    document.getElementById('autoBtn').innerText='خرید Auto-Click (۴۵ سکه سیاه)'; status.innerText='';
  }
  function buyAuto(){const u=users[current];if(u.blackCoins<45){alert('سکه سیاه کافی نیست');return;}u.blackCoins-=45;saveAll();updateUI();
    const status=document.getElementById('autoStatus');status.innerText='Auto-Click فعال شد';
    clearInterval(autoInterval);clearTimeout(autoTimeout);
    autoInterval=setInterval(()=>{u.coins++;if(u.coins%15===0)u.blackCoins++;saveAll();updateUI();},500);
    autoTimeout=setTimeout(()=>{clearInterval(autoInterval);status.innerText='Auto-Click پایان یافت';},5*60*1000);
  }

  // Floors & Mini-games
  const maxF=5, base=1000;
  function renderFloors(){const u=users[current];let h='';for(let i=1;i<=maxF;i++){h+=`<button ${i<=u.floors?'disabled':''} onclick="buyFloor(${i})">${i<=u.floors?'✅':'🪙'} طبقه ${i} - قیمت ${base*i}</button>`;}document.getElementById('floorsContainer').innerHTML=h;}
  function buyFloor(i){const u=users[current],cost=base*i;if(u.coins<cost){alert('سکه کم');return;}u.coins-=cost;u.blackCoins+=15;u.floors=Math.max(u.floors,i);saveAll();updateUI();renderFloors();renderMiniGames();}
  function renderMiniGames(){const u=users[current],ct=document.getElementById('miniGameContainer');ct.innerHTML='';for(let i=1;i<=u.floors;i++){const b=document.createElement('button');b.innerText='بازی '+i;b.onclick=()=>{const w=confirm('برنده شدی؟');if(w){u.coins+=500;saveAll();updateUI();alert('500 سکه!');}};ct.appendChild(b);}}

  // Cheat
  function applyCheat(){const code=prompt('کد تقلب:').toLowerCase(),u=users[current];if(!code)return;if(cheats.includes(current+'_'+code))return alert('قبلا استفاده شد');if(code==='fff')u.coins+=600;else if(code==='ff')u.blackCoins+=25;else if(code==='cp9'){u.coins+=1000;u.blackCoins+=30;}else if(code==='ty'){u.coins+=2000;u.blackCoins+=50;}else return alert('کد اشتباه');cheats.push(current+'_'+code);saveAll();updateUI();alert('اعمال شد');}

  // Event game
  let t,iv,windowsArr;
  function setupEvent(){document.getElementById('eventBtn').onclick=openE;document.getElementById('closeEventBtn').onclick=closeE;}
  function openE(){document.getElementById('eventGame').style.display='block';startE();}
  function closeE(){clearInterval(iv);document.getElementById('eventGame').style.display='none';}
  function startE(){t=60;document.getElementById('timer').innerText='زمان: '+t;const container=document.getElementById('windowsContainer');container.innerHTML='';windowsArr=[];for(let i=0;i<5;i++){const d=document.createElement('div');d.className='window-item';container.appendChild(d);windowsArr.push(d);}iv=setInterval(()=>{if(t<0)return finishE(false);document.getElementById('timer').innerText='زمان: '+t;spawn();t--;},3000);}
  function spawn(){const idx=Math.floor(Math.random()*5);const type=Math.random()<0.5?'◯':'◉';windowsArr.forEach(d=>{d.classList.remove('active');d.innerHTML='';});const el=windowsArr[idx];el.classList.add('active');el.innerHTML=`<p>${type}</p>`;el.onclick=()=>{if(type==='◯'){users[current].blackCoins++;saveAll();updateUI();}else{return finishE(false);} el.onclick=null;};}
  function finishE(win){clearInterval(iv);closeE();const u=users[current];if(win||t>=0){u.coins+=1000;u.blackCoins+=35;saveAll();updateUI();alert('1000 سکه و 35 سیاه!');}else alert('باخت یا زمان تموم شد');}
</script></body>
</html>
