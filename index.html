<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Happy Coin - نسخه 0.3.1</title>
  <!-- CryptoJS AES -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { background: #fffbe6; font-family: Tahoma, sans-serif; text-align: center; padding: 20px; transition: background .3s, color .3s; }
    body.dark { background: #121212; color: #eee; }
    #loginDiv, #gameDiv { max-width: 480px; margin: 20px auto; }
    input, button { font-size: 1rem; padding: 10px; margin: 5px; }
    input { width: 80%; border: 2px solid #c29200; border-radius: 5px; }
    button { background: #c29200; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #a17300; }
    #coin { width: 120px; height: 120px; cursor: pointer; transition: transform .2s; }
    #coin.clicked { transform: scale(1.1); }
    .section { border: 2px solid #c29200; padding: 10px; margin-top: 20px; border-radius: 6px; background: #fff8d6; }
    #autoStatus { margin-top: 10px; color: #070; }
    #eventBtn { position: fixed; top: 20px; right: 20px; padding: 10px 20px; font-size: 14px; }
    #eventContainer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
    #eventContent { background: #222; color: #fff; max-width: 600px; margin: 50px auto; padding: 20px; border-radius: 8px; text-align: center; }
    .windows { display: flex; justify-content: space-around; flex-wrap: wrap; margin-top: 20px; }
    .window { width: 100px; height: 140px; background: #c0d8f0; border: 3px solid #555; border-radius: 8px; position: relative; margin: 5px; }
    .shadow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px; display: none; }
    .shadow.white { background: rgba(255,255,255,0.6); }
    .shadow.black { background: rgba(0,0,0,0.7); }
    .controls { position: absolute; bottom: 5px; width: 100%; display: flex; justify-content: space-around; }
    .controls button { font-size: .9rem; }
    #timer { font-size: 1.5rem; margin-top: 10px; }
    #footer { margin-top: 30px; font-size: 0.9rem; color: gray; }
  </style>
</head>
<body>
  <div id="loginDiv">
    <h2>Happy Coin 🎮</h2>
    <input id="usernameInput" placeholder="اسم خود را وارد کنید" />
    <br><button id="loginBtn">ورود / ثبت‌نام</button>
  </div>  <div id="gameDiv" style="display:none;">
    <h2>سلام <span id="userDisplay"></span>!</h2>
    <img id="coin" src="https://i.postimg.cc/nrWTP5cb/coin-pixel.png" alt="سکه" />
    <div id="count">سکه: 0</div>
    <div id="blackCount">سیاه: 0</div><div class="section">
  <button id="darkModeBtn">تغییر تم (رایگان)</button>
  <button id="autoBtn">Auto-Click (۴۵ سیاه)</button>
  <div id="autoStatus"></div>
</div>

<div class="section">
  <h3>خرید طبقات (+۱۵ سیاه)</h3>
  <div id="floors"></div>
</div>

<div class="section">
  <button id="cheatBtn">کد تقلب</button>
</div>

<div id="footer">
  نسخه: 0.3.1 | ساخته شده توسط <strong>Rob Lucci</strong>
</div>

  </div><button id="eventBtn">ایونت (۱۱۰۰ سکه)</button>

  <div id="eventContainer">
    <div id="eventContent">
      <h3>چالش پنجره‌ها</h3>
      <p>۶۰ ثانیه زنده بمون!</p>
      <div id="timer">زمان: 60</div>
      <div class="windows" id="windowsContainer"></div>
      <button id="closeEventBtn">خروج</button>
    </div>
  </div><script>
  const AES_KEY = 'SuperStrongKey2025!';
  // Encryption
  function encrypt(data) {
    return CryptoJS.AES.encrypt(JSON.stringify(data), AES_KEY).toString();
  }
  function decrypt(cipher) {
    try {
      const bytes = CryptoJS.AES.decrypt(cipher, AES_KEY);
      return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
    } catch {
      return {};
    }
  }

  // persistent encrypted storage
  let db = {};
  let currentUser = null;
  const stored = localStorage.getItem('hc_enc');
  if (stored) db = decrypt(stored);
  const usrEnc = localStorage.getItem('hcUser');
  if (usrEnc) {
    try { currentUser = CryptoJS.AES.decrypt(usrEnc, AES_KEY).toString(CryptoJS.enc.Utf8); } catch {} }

  function save() {
    localStorage.setItem('hc_enc', encrypt(db));
    if (currentUser) {
      localStorage.setItem('hcUser', CryptoJS.AES.encrypt(currentUser, AES_KEY).toString());
    }
  }

  // login
  document.getElementById('loginBtn').onclick = () => {
    const name = document.getElementById('usernameInput').value.trim();
    if (name.length < 2) return alert('اسم باید حداقل ۲ حرف باشد');
    if (!db[name]) db[name] = { coins:0, black:0, floors:0, dark:false, cheats:[] };
    currentUser = name; save(); showGame();
  };
  window.onload = () => { if (currentUser && db[currentUser]) showGame(); };

  function showGame() {
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('gameDiv').style.display = 'block';
    initGame();
  }

  function initGame() {
    const u = db[currentUser];
    document.getElementById('userDisplay').innerText = currentUser;
    document.getElementById('count').innerText = 'سکه: ' + u.coins;
    document.getElementById('blackCount').innerText = 'سیاه: ' + u.black;
    document.body.classList.toggle('dark', u.dark);

    document.getElementById('coin').onclick = clickCoin;
    document.getElementById('darkModeBtn').onclick = toggleDark;
    document.getElementById('autoBtn').onclick = buyAuto;
    renderFloors();
    document.getElementById('cheatBtn').onclick = applyCheat;
    document.getElementById('eventBtn').onclick = startEvent;
    document.getElementById('closeEventBtn').onclick = () => finishEvent(false);
  }

  function clickCoin() {
    const u = db[currentUser]; u.coins++; if (u.coins % 15 === 0) u.black++;
    save(); initGame();
    const el = document.getElementById('coin'); el.classList.add('clicked'); setTimeout(()=> el.classList.remove('clicked'),200);
  }

  function toggleDark() { const u = db[currentUser]; u.dark = !u.dark; save(); document.body.classList.toggle('dark', u.dark); }

  // auto click
  let ai, at;
  function buyAuto() {
    const u = db[currentUser]; if (u.black < 45) return alert('سیاه کم است');
    u.black -= 45; save(); initGame(); document.getElementById('autoStatus').innerText = 'Auto-Click فعال';
    clearInterval(ai); clearTimeout(at);
    ai = setInterval(()=>{ u.coins++; if(u.coins%15===0) u.black++; save(); initGame(); },500);
    at = setTimeout(()=>{ clearInterval(ai); document.getElementById('autoStatus').innerText = 'Auto-Click پایان'; },5*60*1000);
  }

  // floors
  function renderFloors() {
    const u = db[currentUser]; const cont = document.getElementById('floors'); cont.innerHTML='';
    for (let i=1; i<=5; i++) {
      const btn = document.createElement('button');
      btn.innerText = (i<=u.floors?'✅ ':'🪙 ')+`طبقه ${i} - ${i*1000} سکه`;
      if (i<=u.floors) btn.disabled=true; else btn.onclick=()=>buyFloor(i);
      cont.appendChild(btn);
    }
  }
  function buyFloor(i) { const u=db[currentUser], cost=i*1000; if(u.coins<cost) return alert('سکه کم است'); u.coins-=cost; u.black+=15; u.floors=i; save(); initGame(); alert(`طبقه ${i} خرید و +15 سیاه`); }

  // cheat
  function applyCheat() {
    const code = prompt('کد تقلب:'); if(!code) return;
    const u = db[currentUser]; if(u.cheats.includes(code)) return alert('تکراری');
    if(code==='fff') u.coins+=600;
    else if(code==='ff') u.black+=25;
    else if(code==='cp9'){u.coins+=1000;u.black+=30;}
    else if(code==='ty'){u.coins+=2000;u.black+=50;}
    else return alert('کد غلط'); u.cheats.push(code); save(); initGame(); alert('اعمال شد');
  }

  // event
  let timeLeft, evInterval, reactionTimeout;
  function startEvent() {
    const u=db[currentUser]; if(u.coins<1100) return alert('۱۱۰۰ سکه لازم است');
    clearInterval(evInterval); clearTimeout(reactionTimeout);
    u.coins-=1100; save(); initGame();
    document.getElementById('eventContainer').style.display='block';
    timeLeft=60; document.getElementById('timer').innerText='زمان: '+timeLeft;
    showWindow(); evInterval=setInterval(()=>{ timeLeft--; document.getElementById('timer').innerText='زمان: '+timeLeft; if(timeLeft<=0) return finishEvent(true); showWindow();},3000);
  }
  function showWindow() {
    clearTimeout(reactionTimeout);
    const wc=document.getElementById('windowsContainer'); wc.innerHTML='';
    const idx=Math.floor(Math.random()*5); const clr=Math.random()<0.5?'white':'black';
    for(let i=0;i<5;i++){
      const w=document.createElement('div'); w.className='window';
      const sh=document.createElement('div'); sh.className='shadow '+clr; sh.style.display=(i===idx?'block':'none'); w.appendChild(sh);
      const ctrl=document.createElement('div'); ctrl.className='controls';
      const btnL=document.createElement('button'); btnL.innerText='نور'; btnL.disabled=i!==idx;
      const btnB=document.createElement('button'); btnB.innerText='ببند'; btnB.disabled=i!==idx;
      btnL.onclick=()=>handleEvent('white',clr); btnB.onclick=()=>handleEvent('black',clr);
      ctrl.append(btnL,btnB); w.appendChild(ctrl); wc.appendChild(w);
    }
    reactionTimeout=setTimeout(()=>finishEvent(false),3000);
  }
  function handleEvent(act,clr) { clearTimeout(reactionTimeout); if(act!==clr) return finishEvent(false); /* correct */ }
  function finishEvent(win) { clearInterval(evInterval); clearTimeout(reactionTimeout); document.getElementById('eventContainer').style.display='none'; const u=db[currentUser]; if(win){u.coins+=1000;u.black+=35;save();initGame();alert('🎉 برنده شدی! +1000 سکه و +35 سیاه');}else alert('📛 باختی یا دیر شدی'); }
</script></body>
</html>
