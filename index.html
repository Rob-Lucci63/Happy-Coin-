<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Happy Coin - Ù†Ø³Ø®Ù‡ 0.4.9 Ø¨Ø§ Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ ÙˆØ§Ù‚Ø¹ÛŒ</title>
<style>
  body { direction: rtl; font-family: Tahoma, sans-serif; background: #fffbe6; text-align: right; overflow-x:hidden; color:#000; transition: background .4s, color .4s; }
  #loginDiv, #gameDiv { max-width: 480px; margin: 20px auto; }
  input, button { font-size: 1rem; padding: 10px; margin: 5px; transition: background .3s, color .3s; }
  input { width: 80%; border: 2px solid #c29200; border-radius: 5px; }
  button { background: #c29200; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background: #a17300; }
  #coinCanvas { cursor: pointer; margin-top: 20px; transition: transform .2s; }
  #coinCanvas.clicked { transform: scale(1.1); }

  .section { border: 2px solid #c29200; padding: 10px; margin-top: 20px; border-radius: 6px; background: #fff8d6; }
  #autoStatus { margin-top: 10px; color: #070; }

  /* --- Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ --- */
  body.dark { background: #121212; color: #eee; }
  body.dark input { background:#222; color:#fff; border-color:#555; }
  body.dark button { background:#444; color:#fff; }
  body.dark button:hover { background:#666; }
  body.dark .section { background:#1e1e1e; border-color:#555; }

  /* Ø¨Ù†Ø± ØªØ¨Ù„ÛŒØº */
  #coinPromo {
    position: fixed;
    width: 200px;
    height: 80px;
    background: linear-gradient(135deg, #ffe066, #ff7f50);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    overflow: hidden;
    animation: float 3s ease-in-out infinite alternate;
  }
  #coinPromo span {
    font-weight: bold;
    font-size: 1rem;
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
  }
  #coinPromo button {
    margin-top: 5px;
    padding: 6px 12px;
    background: #00bfff;
    border: none;
    border-radius: 10px;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    animation: pulse 1.5s infinite;
  }

  @keyframes float {
    0% { transform: translateY(0) rotate(-2deg); }
    50% { transform: translateY(-6px) rotate(2deg); }
    100% { transform: translateY(0) rotate(-2deg); }
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
</style>
</head>
<body>

<div id="loginDiv">
  <h2>Happy Coin ðŸŽ®</h2>
  <input id="usernameInput" placeholder="Ø§Ø³Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
  <br>
  <button id="loginBtn">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
</div>

<div id="gameDiv" style="display:none;">
  <h2>Ø³Ù„Ø§Ù… <span id="userDisplay"></span>!</h2>
  <canvas id="coinCanvas" width="120" height="120"></canvas>
  <div id="count">Ø³Ú©Ù‡: 0</div>
  <div id="blackCount">Ø³ÛŒØ§Ù‡: 0</div>

  <!-- ØªØ¨Ù„ÛŒØº -->
  <div id="coinPromo">
    <span>ðŸ’° Happy Coin!</span>
    <button id="promoBtn">Ø´Ø±ÙˆØ¹</button>
  </div>

  <div class="section">
    <button id="darkModeBtn">ØªØºÛŒÛŒØ± ØªÙ… (Ø±Ø§ÛŒÚ¯Ø§Ù†)</button>
    <button id="autoBtn">Auto-Click (Û´Ûµ Ø³ÛŒØ§Ù‡)</button>
    <div id="autoStatus"></div>
  </div>

  <div class="section">
    <h3>Ø®Ø±ÛŒØ¯ Ø·Ø¨Ù‚Ø§Øª (+Û±Ûµ Ø³ÛŒØ§Ù‡)</h3>
    <div id="floors"></div>
  </div>

  <div class="section">
    <button id="cheatBtn">Ú©Ø¯ ØªÙ‚Ù„Ø¨</button>
  </div>

  <button id="eventBtn">Ø§ÛŒÙˆÙ†Øª (Û±Û±Û°Û° Ø³Ú©Ù‡)</button>
  <div id="footer">Ù†Ø³Ø®Ù‡: 0.4.9 | Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· <strong>Rob Lucci</strong></div>
</div>

<script>
  // --- Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ---
  let db = {}, currentUser = null;
  function save(){ if(currentUser) localStorage.setItem('hcUser', currentUser); localStorage.setItem('hcData', JSON.stringify(db)); }
  function load(){ const stored=localStorage.getItem('hcData'); if(stored) db=JSON.parse(stored); const u=localStorage.getItem('hcUser'); if(u) currentUser=u; }
  load();

  const loginBtn=document.getElementById('loginBtn');
  const usernameInput=document.getElementById('usernameInput');
  loginBtn.onclick=()=>{ 
    const name=usernameInput.value.trim(); 
    if(name.length<2) return alert('Ø§Ø³Ù… Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª'); 
    if(!db[name]) db[name]={coins:0,black:0,floors:0,dark:false,cheats:[]}; 
    currentUser=name; save(); showGame(); 
  };
  
  function showGame(){
    document.getElementById('loginDiv').style.display='none';
    document.getElementById('gameDiv').style.display='block';
    document.getElementById('userDisplay').innerText=currentUser;
    renderUI();
    bindEvents();
    initPromoPositioning();
  }

  function renderUI(){ 
    const u=db[currentUser]; 
    document.getElementById('count').innerText='Ø³Ú©Ù‡: '+u.coins; 
    document.getElementById('blackCount').innerText='Ø³ÛŒØ§Ù‡: '+u.black; 
    document.body.classList.toggle('dark', u.dark); 
    drawCoin(); renderFloors(); 
  }

  const canvas=document.getElementById('coinCanvas'), ctx=canvas.getContext('2d');
  function drawCoin(){ 
    const cx=60,cy=60,r=50; 
    const g=ctx.createRadialGradient(cx-10,cy-10,10,cx,cy,r); 
    g.addColorStop(0,'#fff2a8'); g.addColorStop(.5,'#ffd700'); g.addColorStop(1,'#b8860b'); 
    ctx.clearRect(0,0,120,120); ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI); ctx.fillStyle=g; ctx.fill(); ctx.lineWidth=4; ctx.strokeStyle='#e5c100'; ctx.stroke(); 
  }
  canvas.addEventListener('click',()=>{ canvas.classList.add('clicked'); setTimeout(()=>canvas.classList.remove('clicked'),200); clickCoin(); });
  function clickCoin(){ const u=db[currentUser]; u.coins++; if(u.coins%15===0) u.black++; save(); renderUI(); }

  function bindEvents(){
    document.getElementById('darkModeBtn').onclick=()=>{ const u=db[currentUser]; u.dark=!u.dark; save(); renderUI(); };
    document.getElementById('autoBtn').onclick=buyAuto;
    document.getElementById('cheatBtn').onclick=applyCheat;
    document.getElementById('eventBtn').onclick=startEvent;
    document.getElementById('promoBtn').onclick=()=> window.open('https://rob-lucci63.github.io/Happy-Coin-Crypto-War/','_blank');
  }

  function buyAuto(){ const u=db[currentUser]; if(u.black<45){ alert('Ø³ÛŒØ§Ù‡ Ú©Ù… Ø§Ø³Øª'); return;} u.black-=45; save(); renderUI(); alert('Auto-Click ÙØ¹Ø§Ù„ Ø´Ø¯'); }

  function renderFloors(){ 
    const u=db[currentUser]; 
    const ct=document.getElementById('floors'); ct.innerHTML=''; 
    for(let i=1;i<=5;i++){ 
      const btn=document.createElement('button'); 
      btn.innerText=(i<=u.floors?'âœ… ':'ðŸª™ ')+'Ø·Ø¨Ù‚Ù‡ '+i+' - '+i*1000+' Ø³Ú©Ù‡'; 
      if(i>u.floors) btn.onclick=()=>{ 
        if(u.coins<i*1000) alert('Ø³Ú©Ù‡ Ú©Ù… Ø§Ø³Øª'); 
        else { u.coins-=i*1000; u.black+=15; u.floors=i; save(); renderUI(); alert('Ø®Ø±ÛŒØ¯ Ø´Ø¯'); } 
      } 
      ct.appendChild(btn); 
    }
  }
  function applyCheat(){ let c=prompt('Ú©Ø¯ ØªÙ‚Ù„Ø¨:'); if(!c) return; const u=db[currentUser]; if(c==='fff') u.coins+=600; else if(c==='ff') u.black+=25; else alert('Ú©Ø¯ ØºÙ„Ø·'); save(); renderUI(); }

  function startEvent(){ alert('Ø§ÛŒÙˆÙ†Øª Ø´Ø±ÙˆØ¹ Ø´Ø¯!'); }

  // --- ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´Øª ---
  window.addEventListener('DOMContentLoaded', () => {
    if (currentUser && db[currentUser]) {
      setTimeout(() => showGame(), 50);
    }
  });

  // --- ØªØ¨Ù„ÛŒØº Ú©Ù†Ø§Ø± Ø³Ú©Ù‡ ---
  function positionPromoNearCoin() {
    const promo = document.getElementById('coinPromo');
    const canvas = document.getElementById('coinCanvas');
    if (!promo || !canvas) return;
    const cRect = canvas.getBoundingClientRect();
    const promoRect = promo.getBoundingClientRect();
    let left = cRect.right + 10;
    let top = cRect.top + (cRect.height/2) - (promoRect.height/2);
    if (left + promoRect.width > window.innerWidth - 10) {
      left = cRect.left - promoRect.width - 10;
    }
    if (top < 10) top = 10;
    if (top + promoRect.height > window.innerHeight - 10) top = window.innerHeight - promoRect.height - 10;
    promo.style.left = `${Math.round(left)}px`;
    promo.style.top = `${Math.round(top)}px`;
    promo.style.position = 'fixed';
  }
  function initPromoPositioning() {
    positionPromoNearCoin();
    window.addEventListener('resize', () => {
      clearTimeout(window._hcPromoResizeTimer);
      window._hcPromoResizeTimer = setTimeout(positionPromoNearCoin, 120);
    });
  }
</script>
</body>
</html>